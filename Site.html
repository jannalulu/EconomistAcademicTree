<!DOCTYPE html>
<html>
<head>
  <title>Hierarchical Network Graph</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    .node {
      fill: #ccc;
      stroke: #fff;
      stroke-width: 1.5px;
    }

    .link {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .label {
      font-size: 12px;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <svg width="800" height="600"></svg>

  <script>
    const svg = d3.select('svg');
    const width = +svg.attr('width');
    const height = +svg.attr('height');

    const simulation = d3.forceSimulation()
      .force('link', d3.forceLink().id(d => d.id))
      .force('charge', d3.forceManyBody().strength(-100))
      .force('center', d3.forceCenter(width / 2, height / 2));

    d3.csv('merged20240308.csv')
      .then(data => {
        console.log('Loaded data:', data);

        const nodes = Array.from(new Set(data.flatMap(d => [d.influencedBy, d.economist])))
          .map(id => ({ id }));

        const edges = data.map(d => ({
          source: d.influencedBy,
          target: d.economist
        }));

        console.log('Nodes:', nodes);
        console.log('Edges:', edges);

        const link = svg.append('g')
          .attr('class', 'links')
          .selectAll('line')
          .data(edges)
          .join('line')
          .attr('class', 'link');

        const node = svg.append('g')
          .attr('class', 'nodes')
          .selectAll('circle')
          .data(nodes)
          .join('circle')
          .attr('class', 'node')
          .attr('r', 5)
          .call(drag(simulation));

        const label = svg.append('g')
          .attr('class', 'labels')
          .selectAll('text')
          .data(nodes)
          .join('text')
          .attr('class', 'label')
          .text(d => d.id);

        simulation.nodes(nodes).on('tick', ticked);
        simulation.force('link').links(edges);
      })
      .catch(error => {
        console.error('Error loading data:', error);
      });

    function ticked() {
      d3.select('.links')
        .selectAll('line')
        .attr('x1', d => d.source.x)
        .attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x)
        .attr('y2', d => d.target.y);

      d3.select('.nodes')
        .selectAll('circle')
        .attr('cx', d => d.x)
        .attr('cy', d => d.y);

      d3.select('.labels')
        .selectAll('text')
        .attr('x', d => d.x + 8)
        .attr('y', d => d.y + 4);
    }

    function drag(simulation) {
      function dragstarted(event) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        event.subject.fx = event.subject.x;
        event.subject.fy = event.subject.y;
      }

      function dragged(event) {
        event.subject.fx = event.x;
        event.subject.fy = event.y;
      }

      function dragended(event) {
        if (!event.active) simulation.alphaTarget(0);
        event.subject.fx = null;
        event.subject.fy = null;
      }

      return d3.drag()
        .on('start', dragstarted)
        .on('drag', dragged)
        .on('end', dragended);
    }
  </script>
</body>
</html>